# Autor: Erik Churo Churo
# 
# Automatizacion de la carga de fichero de configuracion
# para el terminal.
#
# Para cargar una nueva configuracion debemos de llamar al metodo
# bashrc_bash_crear seguido del directorio y del nombre del
# fichero de configuracion.
# Ejemplo : 
#  bashrc_bash_crear /home/erik/Documentos/Proyectos/mibash git_comando
#
# Automaticamente se genera :
# - El fichero de configuracion git_comandos en el directorio /home/erik/Documentos/Proyectos/mibash
# - Un soft link en el directorio ~/ con el nombre .bashrc_bash_git_comandos que apunta al fichero de configuracion creado en el paso anterior.
# - Agregamos las sentencias en el fichero especificado por $bashrc_bash_user para cargar el fichero de configuracion.
# - Recargamos la configuracion principal del terminal, es decir, ~/.bashrc .
#
# No debemos manipular el fichero ~/.bashrc_bashrc existe una serie de funciones que nos
# permiten realizar cada uno de los pasos anteriores si por algun motivo el punto de partida
# sea alguno de los puntos anteriores. Estas funciones son :
# - Creamos un nuevo fichero de configuracion
#   bashrc_bash_fichero_crear /home/erik/Documentos/Proyectos/mibash/lava_master 
# - Crear un link del fichero de configuracion ya existente en ~/ con el formado .bashrc_bash_*
#   bashrc_bash_link_crear /home/erik/Documentos/Proyectos/mibash/lava_master ~/bashrc_bash_lava-master
# - Agrega las sentencias en ~/.bashrc_bashrc para cargar el fichero de configuracion
#   bashrc_bash_cargar ~/.bashrc_bash_lava
# - Recargamos la configuracion principal de la terminal
#   bashrc_recargar 
#
# Tras editar el fichero de configuracion es necesario volver a recargar ~/.bashrc para
# disponer las nuevas funcionalidades en el terminal
#   bashrc_recargar

#si existe algun error para la ejecucion


#fichero de configuracion principal para bashrc_bashrc

export bashrc_bash_user=/root/.bashrc_bash_root

#Recargamos la configuracion principal de la terminal de usuario
function bashrc_recargar(){
    . ~/.bashrc
}

#Crea un fichero de configuracion en la ruta especificada.
#Parametros :
#  arg1 , ruta completa del fichero. 
function bashrc_bash_fichero_crear(){
    #solo se crea si no existe
    if [ ! -f "$1" ]; then
	echo >> "$1";
	echo "INFO: Creado fichero de configuracion : $1 .";
    else
	echo "ERROR: El fichero de configuracion ya existe. ";
	return 1
    fi	
}

#Crea el soft link
#Parametros :
# arg1 , ruta completa del fichero de configuracion
# arg2 , ruta completa del link que apunta al fichero de configuracion
function bashrc_bash_link_crear(){
    if [ -f $1 ]; then
	ln -s -f $1 $2
	echo  "INFO: Creado link $1 A $2."
    else
	echo  "ERROR: $1 no es un fichero valido."
	return 1
    fi
}
#Cargamos las sentencias en ~./bashrc_bashrc para cargar el fichero de configuracion
#Parametros:
# arg1 , ruta completa del link que apunta al fichero de configuracion
function bashrc_bash_cargar(){
    if [ ! -f $bashrc_bash_user ]; then
	#creamos el fichero ~/.bashrc_bashrc
	
	bashrc_bash_fichero_crear $bashrc_bash_user
	echo "INFO: Creado fichero $bashrc_bash_user .";
    fi
    if [ ! -f "$1" ]; then
	echo "ERROR: Imposible cargar la configuracion $1 en $bashrc_bash_user .";
	return 1
    fi
    cat >> $bashrc_bash_user <<EOF
if [ ! -f $1 ]; then
 . $1;
fi
EOF
    echo "INFO: Cargada configuracion en $bashrc_bash_user .";
}



#Creamos una nueva configuracion para nuestro terminal
#Parametros :
# arg1 , directorio del fichero de configuracion
# arg2 , nombre del fichero de configuracion. Solo el nombre no la ruta completa del fichero.
function bashrc_bash_crear(){
    #ruta de origen
    origen=$1/$2;
    #ruta destino, es la del link
    destino=~/.bashrc_bash_"$2"
    #creamos el fichero de configuraciÃ³n si no existe. Es origen.
    bashrc_bash_fichero_crear $origen;
    #creamos el link. Es destino.
    bashrc_bash_link_crear $origen $destino;
    #cargamos la configuracion origen 
    bashrc_bash_cargar $destino
}


#Exportamos las funciones 
export -f bashrc_bash_link_crear;
export -f bashrc_bash_cargar;
export -f bashrc_bash_fichero_crear;
export -f bashrc_bash_crear;
export -f bashrc_recargar;
alias bashrc_bash_ls="ls -l -a ~/ | grep .bashrc_bash_"
alias bashrc_bash_links_rm="rm ~/.bashrc_bash_*"
#Cargamos el resto de configuraciones

if [ -f $bashrc_bash_user ]; then
    . $bashrc_bash_user
fi





